<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ν¬μΈνΈ μƒμ </title>
  <link rel="stylesheet" href="./css/sidebar.css" />
  <link rel="stylesheet" href="./css/point_store_style.css" />
</head>

<body>
  <!-- λ΅κ·ΈμΈ/μ΄κΈ°ν™”: user_id, μ΄κΈ° ν¬μΈνΈ, API λ² μ΄μ¤ μ„¤μ • -->
  <script>
    (function () {
      const params = new URLSearchParams(location.search);
      const uid = params.get('uid') || localStorage.getItem('user_id');
      if (!uid) {
        alert("λ΅κ·ΈμΈμ΄ ν•„μ”ν•©λ‹λ‹¤.");
        location.href = "./login.html";
        return;
      }

      // νμ΄μ§€ μ „μ—­ μ£Όμ…
      document.body.dataset.userId = uid;

      // μ΄κΈ° ν¬μΈνΈ(μΊμ‹) β†’ μ„λ²„ λ™κΈ°ν™” μ „ κΉλΉ΅μ„ λ°©μ§€
      const cached = Number(localStorage.getItem('points'));
      window.__initialPoints__ = Number.isFinite(cached) ? cached : 0;

      // API μ „μ—­ (ν•„μ” μ‹ λ°°ν¬ μ£Όμ†λ΅ κµμ²΄)
      window.API = "http://localhost:8000";
      window.__API__ = window.API; // ν•μ„ νΈν™

      // DOM μ¤€λΉ„ ν›„ μƒλ‹¨ μΉ© μ¦‰μ‹ λ°μ
      document.addEventListener("DOMContentLoaded", () => {
        const el = document.getElementById("points");
        if (el) el.textContent = `${window.__initialPoints__}P`;
      });
    })();
  </script>

  <!-- ====== μ‚¬μ΄λ“λ°” ====== -->
  <div class="sidebar">
    <h2><a href="../index.html" class="site-title">μ„μ¦μ£Όμ‹</a></h2>
    <nav class="sidebar-nav">
      <a href="../index.html">μ£Όμ‹ κµμ΅ λ° ν€΄μ¦</a>
      <a href="./stock_prediction_game.html">μ£Όκ°€μμΈ΅κ²μ„</a>
      <a href="./point_store.html" class="active" aria-current="page">ν¬μΈνΈ μƒμ </a>
      <a href="./event.html">μ΄λ²¤νΈ</a>
      <a href="./my_page.html">λ§μ΄νμ΄μ§€</a>
    </nav>
    <button id="logout-btn" class="logout-button">λ΅κ·Έμ•„μ›ƒ</button>

    <section class="ranking-section">
      <h3 class="ranking-title">π† μ‹¤μ‹κ°„ λ³΄μ  ν¬μΈνΈ μμ„</h3>
      <ol class="ranking-list">
        <li class="ranking-item"><span class="ranking-number">1</span><span class="user-name">κΉ€λ―Όμ¤€</span></li>
        <li class="ranking-item"><span class="ranking-number">2</span><span class="user-name">λ°•μ„μ¤€</span></li>
        <li class="ranking-item"><span class="ranking-number">3</span><span class="user-name">μ΄μ§€ν›</span></li>
        <li class="ranking-item"><span class="ranking-number">4</span><span class="user-name">μµμ€μ„</span></li>
        <li class="ranking-item"><span class="ranking-number">5</span><span class="user-name">μ •μ°μ§„</span></li>
      </ol>
    </section>

    <p class="copyright-text">Copyright 2025. kdt-team-one All rights reserved.</p>
  </div>

  <!-- ====== μ½ν…μΈ  μμ—­ ====== -->
  <header class="store__header">
    <h1 id="page-title" class="page-title">π›’ μ•„μ΄ν… μƒμ </h1>
    <div class="point-chip">λ³΄μ  ν¬μΈνΈ <strong id="points">0P</strong></div>
  </header>

  <main id="content" class="store" aria-labelledby="page-title">
    <section class="store__notice" hidden></section>
    <section id="storeGrid" class="store-grid"></section>
  </main>

  <!-- ν™•μΈ λ¨λ‹¬ -->
  <div id="backdrop" class="modal-backdrop" hidden></div>
  <div id="modal" class="modal" hidden role="dialog" aria-modal="true"
       aria-labelledby="modal-title" aria-describedby="modal-desc" tabindex="-1">
    <div class="title" id="modal-title">κµ¬λ§¤ ν™•μΈ</div>
    <div class="desc" id="modal-desc">μƒν’ μ •λ³΄λ¥Ό λ¶λ¬μ¤λ” μ¤‘...</div>
    <div class="modal__actions">
      <button id="buyConfirm" class="btn btn--primary">μ, κµ¬λ§¤ν• κ²μ” β…</button>
      <button id="buyCancel" class="btn" value="cancel">μ·¨μ†</button>
    </div>
  </div>

  <!-- ν† μ¤νΈ -->
  <div id="toast" class="toast" role="status" aria-live="polite" hidden></div>

  <!-- μ¤ν¬λ¦½νΈ: μƒμ  β†’ λ΅κ·ΈμΈκ³µν†µ(λ΅κ·Έμ•„μ›ƒ) -->
  <script defer src="../js/point_store.js"></script>
  <script defer src="../js/login.js"></script>
</body>
</html>
